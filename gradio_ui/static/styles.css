/* Base Typography */
body {
    font-family: 'Microsoft YaHei', '微软雅黑', 'SimSun', '宋体', sans-serif;
    color: #000000;
    background-color: #ffffff;
}

/* Main Gradio Container - Constrain entire page width */
.gradio-container {
    max-width: 1000px !important;
    margin: 0 auto !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

/* Tab Content - Ensure tabs respect container width */
.gradio-tabs {
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

.gradio-tabs > .tab-nav {
    max-width: 100% !important;
}

.gradio-tabs > .tab-content {
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
}

/* Tab panels - prevent horizontal overflow */
.gradio-tabs .tab-item {
    max-width: 100% !important;
    width: 100% !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
}

/* Main Container */
.main-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 4px;
}

/* Hexagram Line Styling */
.hexagram-line {
    font-family: 'SimSun', '宋体', monospace;
    transition: all 0.3s ease;
}
.hexagram-line:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12) !important;
}
.hexagram-line.yang {
    color: #d32f2f;
}
.hexagram-line.yin {
    color: #2e7d32;
}
.hexagram-line.changing {
    font-weight: 600;
}
.hexagram-line-container {
    margin: 2px 0; /* Match yao-line-button margin for consistent spacing */
}

/* Gan-Zhi Button Styling */
.ganzhi-button {
    min-width: 50px !important;
    max-width: 100% !important;
    font-family: 'SimSun', '宋体', monospace;
    font-size: 16px;
    padding: 10px 14px;
    margin: 3px;
    border-radius: 8px;
    transition: all 0.25s ease;
    background-color: #ffffff;
    border: 2px solid #000000;
    color: #000000;
    font-weight: 600;
    box-sizing: border-box !important;
    flex: 1 1 auto !important;
}
.ganzhi-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    border-color: #000000;
    background-color: #f0f0f0;
}
.ganzhi-button:active,
.ganzhi-button.clicked {
    background-color: #000000 !important;
    color: #ffffff !important;
    border-color: #000000 !important;
    transform: translateY(0px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3) !important;
}
.ganzhi-button.clicked {
    animation: buttonClick 0.3s ease;
}
@keyframes buttonClick {
    0% { transform: scale(1); }
    50% { transform: scale(0.95); }
    100% { transform: scale(1); }
}

/* Desktop: Show symbols, hide kanji for HTML elements */
.line-symbol-desktop {
    display: inline !important;
}
.line-symbol-mobile {
    display: none !important;
}

/* Yao Line Button Styling - Match hexagram-line-container styling */
.yao-line-button {
    font-family: 'SimSun', '宋体', monospace;
    font-size: 26px;
    font-weight: 400;
    padding: 12px 20px;
    border-radius: 8px;
    transition: all 0.3s ease;
    min-height: 64px;
    height: 64px;
    text-align: center;
    width: 100%;
    margin: 2px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    position: relative;
    box-sizing: border-box;
}

/* Desktop: Buttons show symbols normally */
/* Button format: "SYMBOL line_num爻" - no kanji in button text */
/* On desktop: Show button text normally (symbol + line number) */
.yao-line-button::before {
    display: none !important; /* No kanji via ::before on desktop */
}
/* Button text shows normally on desktop - symbols and line number visible */

/* Container for 本卦 and 變卦 - fill column width without centering */
.hexagram-display-row .column-spacing {
    flex: 1 1 auto !important;
    min-width: 0 !important;
}

.hexagram-display-row .column-spacing:first-child,
.hexagram-display-row .column-spacing:last-child {
    display: flex;
    flex-direction: column;
    align-items: stretch;
}

.hexagram-display-row .column-spacing:first-child > *,
.hexagram-display-row .column-spacing:last-child > * {
    width: 100%;
    max-width: 100%;
}
/* Yang line buttons (red) - use multiple selectors for robustness */
button.yao-line-button.yang-button,
.yao-line-button.yang-button,
button.yang-button.yao-line-button {
    background-color: #ef4444 !important;
    border: 1.5px solid #b71c1c !important;
    color: #ffffff !important;
    box-shadow: 0 1px 3px rgba(183, 28, 28, 0.4) !important;
}
/* Yin line buttons (green) */
button.yao-line-button.yin-button,
.yao-line-button.yin-button,
button.yin-button.yao-line-button {
    background-color: #75cc0d !important;
    border: 1.5px solid #1b5e20 !important;
    color: #ffffff !important;
    box-shadow: 0 1px 3px rgba(27, 94, 32, 0.4) !important;
}
/* Changing yang line buttons */
button.yao-line-button.yang-button.changing,
.yao-line-button.yang-button.changing,
button.yang-button.yao-line-button.changing {
    background-color: #e96a6a !important;
    border: 1.5px solid #d32f2f !important;
    color: #ffffff !important;
    box-shadow: 0 2px 6px rgba(211, 47, 47, 0.5) !important;
    font-weight: 600 !important;
}
/* Changing yin line buttons */
button.yao-line-button.yin-button.changing,
.yao-line-button.yin-button.changing,
button.yin-button.yao-line-button.changing {
    background-color: #64db68 !important;
    border: 1.5px solid #2e7d32 !important;
    color: #ffffff !important;
    box-shadow: 0 2px 6px rgba(46, 125, 50, 0.5) !important;
    font-weight: 600 !important;
}

/* Ensure all text inside buttons is white */
button.yao-line-button *,
.yao-line-button * {
    color: #ffffff !important;
}
.yao-line-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
}

/* Changing Button Styling */
.yao-button-changing {
    font-family: 'SimSun', '宋体', monospace;
    font-size: 18px;
    font-weight: 500;
    padding: 14px 26px;
    border-radius: 10px;
    transition: all 0.3s ease;
    min-height: 50px;
    background-color: #ffffff;
    border: 1.5px solid #dee2e6;
}
.yao-button-changing:hover {
    background-color: #fff8f0 !important;
    border-color: #d4a574 !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 165, 116, 0.2);
}

/* Line Preview */
.line-preview {
    font-family: 'SimSun', '宋体', monospace;
    font-size: 24px;
    padding: 12px;
    text-align: center;
    background-color: #ffffff;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

/* Result Table */
.result-table {
    font-family: 'SimSun', '宋体', monospace;
    font-size: 14px;
    line-height: 1.8;
    white-space: pre;
    background-color: #ffffff;
    border: 2px solid #000000;
    border-radius: 8px;
}

/* Hidden result table for copy functionality */
.result-table-hidden {
    position: absolute !important;
    left: -9999px !important;
    width: 1px !important;
    height: 1px !important;
    overflow: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    padding: 20px;
    color: #000000;
}

/* Tab Styling */
.tab-nav {
    border-bottom: 2px solid #e9ecef;
}
.tab-nav button {
    font-weight: 500;
    color: #6c757d;
    transition: all 0.2s ease;
}
.tab-nav button:hover {
    color: #495057;
}
.tab-nav button.selected {
    color: #212529;
    border-bottom: 2px solid #212529;
}

/* Input Styling */
input[type="text"], input[type="number"], select, textarea {
    border: 2px solid #000000;
    border-radius: 8px;
    padding: 10px 14px;
    transition: all 0.2s ease;
    background-color: #ffffff;
    color: #000000;
}
input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
    border-color: #000000;
    box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
    outline: none;
}

/* Dropdown Styling */
select {
    background-color: #ffffff;
    color: #000000;
    font-weight: 500;
}

/* Checkbox Styling */
input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: #000000;
    cursor: pointer;
}
label {
    color: #000000;
    font-weight: 500;
}

/* Changing Yao Checkbox Styling - Large Rectangular */
.changing-yao-checkbox {
    width: 100% !important;
    min-width: 120px !important;
    max-width: 250px !important;
    overflow: hidden !important;
    contain: layout style !important;
    position: relative !important;
}
.changing-yao-checkbox > div,
.changing-yao-checkbox > label,
.changing-yao-checkbox label {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 100% !important;
    min-height: 64px !important;
    padding: 14px 20px !important;
    margin: 0 !important;
    border: 2px solid #000000 !important;
    border-radius: 8px !important;
    background: #ffffff !important;
    transition: box-shadow 0.3s ease, background-color 0.3s ease, border-color 0.3s ease !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15) !important;
    cursor: pointer !important;
    font-size: 26px !important;
    color: #000000 !important;
    font-weight: 600 !important;
    letter-spacing: 0.5px !important;
    gap: 12px !important;
    overflow: visible !important;
    white-space: nowrap !important;
    will-change: box-shadow !important;
}
.changing-yao-checkbox > div:hover,
.changing-yao-checkbox > label:hover,
.changing-yao-checkbox label:hover {
    transform: translateY(0) !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
    border-color: #000000 !important;
    background: #f0f0f0 !important;
}
.changing-yao-checkbox input[type="checkbox"] {
    cursor: pointer !important;
    accent-color: #000000 !important;
    margin: 0 !important;
}
.changing-yao-checkbox input[type="checkbox"]:checked ~ span,
.changing-yao-checkbox:has(input[type="checkbox"]:checked) > div,
.changing-yao-checkbox:has(input[type="checkbox"]:checked) > label,
.changing-yao-checkbox:has(input[type="checkbox"]:checked) label {
    background: #fff8f0 !important;
    border-color: #d4a574 !important;
    box-shadow: 0 2px 6px rgba(212, 165, 116, 0.25) !important;
}

/* Button Styling */
button.primary {
    background-color: #000000;
    color: #ffffff;
    border: 2px solid #000000;
    border-radius: 8px;
    padding: 12px 24px;
    font-weight: 700;
    transition: all 0.2s ease;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}
button.primary:hover {
    background-color: #333333;
    border-color: #333333;
    transform: translateY(-1px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.4);
}
button.secondary {
    background-color: #ffffff;
    color: #000000;
    border: 2px solid #000000;
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 700;
    transition: all 0.2s ease;
}
button.secondary:hover {
    background-color: #f0f0f0;
    border-color: #000000;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* Markdown Headers */
h1, h2, h3, h4 {
    color: #000000;
    font-weight: 700;
    letter-spacing: 0.3px;
}
h1 {
    font-size: 32px;
    margin-bottom: 8px;
    font-weight: 800;
    letter-spacing: 0.5px;
}
.main-title {
    margin-bottom: 8px;
}
h2 {
    font-size: 22px;
    margin-bottom: 12px;
    font-weight: 700;
}
h3 {
    font-size: 18px;
    margin-bottom: 6px;
    color: #000000;
    font-weight: 700;
}
.section-header {
    margin-bottom: 7px;
}

/* Section Spacing */
.section-divider {
    margin: 18px 0;
    border-top: 2px solid #000000;
    border-bottom: none;
}

/* Hexagram Display Row */
.hexagram-display-row {
    margin-top: 4px;
    gap: 0px;
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
    display: flex !important;
    flex-wrap: nowrap !important;
    flex-direction: row !important;
    overflow: hidden !important;
}

/* Card-like Containers */
.card {
    background-color: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Column Spacing */
.column-spacing {
    padding: 0 2px;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
}

/* Ensure rows within tabs don't overflow */
.gradio-row {
    max-width: 100% !important;
    box-sizing: border-box !important;
    flex-wrap: wrap !important;
}

/* Ensure columns within tabs respect width */
.gradio-column {
    max-width: 100% !important;
    box-sizing: border-box !important;
    min-width: 0 !important;
}

/* Button rows - ensure they wrap and don't force expansion */
.gradio-row:has(.ganzhi-button) {
    flex-wrap: wrap !important;
    max-width: 100% !important;
    gap: 4px !important;
}

/* 地支 button rows - prevent wrapping to maintain 6 buttons per row */
.dizhi-button-row {
    flex-wrap: nowrap !important;
    max-width: 100% !important;
    gap: 4px !important;
}

/* Button containers - ensure they don't overflow */
.gradio-row:has(.ganzhi-button) > * {
    flex: 0 1 auto !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

/* Refined Text Colors */
.text-muted {
    color: #333333;
    line-height: 1.6 !important;
    overflow: visible !important;
    white-space: normal !important;
    word-wrap: break-word !important;
    font-weight: 500 !important;
}
.text-primary {
    color: #000000;
    font-weight: 600;
}

/* Smooth Transitions */
* {
    transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
}

/* Dark Theme Support */
@media (prefers-color-scheme: dark) {
    /* Base Typography - Dark Theme */
    body {
        color: #ffffff;
        background-color: #000000;
    }
    
    /* Main Container - Dark Theme */
    .main-container {
        background-color: #1a1d20;
    }
    
    /* Hexagram Line Styling - Dark Theme */
    .hexagram-line:hover {
        box-shadow: 0 4px 12px rgba(255,255,255,0.3) !important;
    }
    .hexagram-line.yang {
        color: #ff4444;
    }
    .hexagram-line.yin {
        color: #00ff00;
    }
    
    /* Gan-Zhi Button Styling - Dark Theme */
    .ganzhi-button {
        background-color: #1a1a1a;
        border: 2px solid #ffffff;
        color: #ffffff;
        font-weight: 700;
    }
    .ganzhi-button:hover {
        box-shadow: 0 4px 8px rgba(255,255,255,0.3);
        border-color: #ffffff;
        background-color: #333333;
    }
    .ganzhi-button:active,
    .ganzhi-button.clicked {
        background-color: #ffffff !important;
        color: #000000 !important;
        border-color: #ffffff !important;
        transform: translateY(0px);
        box-shadow: 0 2px 4px rgba(255,255,255,0.4) !important;
    }
    
    /* Yao Line Button Styling - Dark Theme */
    .yao-line-button {
        background-color: #2d3339;
        border: 1.5px solid #495057;
        color: #e9ecef;
    }
    .yao-line-button:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        border-color: #6c757d;
    }
    
    /* Changing Button Styling - Dark Theme */
    .yao-button-changing {
        background-color: #2d3339;
        border: 1.5px solid #495057;
    }
    .yao-button-changing:hover {
        background-color: #3d2f1f !important;
        border-color: #d4a574 !important;
        box-shadow: 0 4px 12px rgba(212, 165, 116, 0.3);
    }
    
    /* Line Preview - Dark Theme */
    .line-preview {
        background-color: #2d3339;
        border: 1px solid #495057;
        color: #e9ecef;
    }
    
    /* Result Table - Dark Theme */
    .result-table {
        background-color: #000000;
        border: 2px solid #ffffff;
        color: #ffffff;
    }
    
    /* Tab Styling - Dark Theme */
    .tab-nav {
        border-bottom: 2px solid #ffffff;
    }
    .tab-nav button {
        color: #cccccc;
        font-weight: 600;
    }
    .tab-nav button:hover {
        color: #ffffff;
    }
    .tab-nav button.selected {
        color: #ffffff;
        border-bottom: 3px solid #ffffff;
        font-weight: 800;
    }
    
    /* Input Styling - Dark Theme */
    input[type="text"], input[type="number"], select, textarea {
        border: 2px solid #ffffff;
        background-color: #000000;
        color: #ffffff;
    }
    input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
        border-color: #ffffff;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }
    
    /* Dropdown Styling - Dark Theme */
    select {
        background-color: #000000;
        color: #ffffff;
        font-weight: 600;
    }
    
    /* Checkbox Styling - Dark Theme */
    input[type="checkbox"] {
        accent-color: #ffffff;
    }
    label {
        color: #ffffff;
        font-weight: 600;
    }
    
    /* Changing Yao Checkbox - Dark Theme */
    .changing-yao-checkbox > div,
    .changing-yao-checkbox > label,
    .changing-yao-checkbox label {
        border: 2px solid #ffffff !important;
        background: #000000 !important;
        color: #ffffff !important;
        box-shadow: 0 2px 4px rgba(255,255,255,0.2) !important;
        font-weight: 700 !important;
        white-space: nowrap !important;
    }
    .changing-yao-checkbox > div:hover,
    .changing-yao-checkbox > label:hover,
    .changing-yao-checkbox label:hover {
        box-shadow: 0 4px 12px rgba(255,255,255,0.3) !important;
        border-color: #ffffff !important;
        background: #1a1a1a !important;
    }
    .changing-yao-checkbox input[type="checkbox"]:checked ~ span,
    .changing-yao-checkbox:has(input[type="checkbox"]:checked) > div,
    .changing-yao-checkbox:has(input[type="checkbox"]:checked) > label,
    .changing-yao-checkbox:has(input[type="checkbox"]:checked) label {
        background: #2a1f0f !important;
        border-color: #ffaa00 !important;
        box-shadow: 0 2px 6px rgba(255, 170, 0, 0.5) !important;
    }
    .changing-yao-checkbox input[type="checkbox"] {
        accent-color: #ffffff !important;
    }
    
    /* Button Styling - Dark Theme */
    button.primary {
        background-color: #ffffff;
        color: #000000;
        border: 2px solid #ffffff;
        font-weight: 800;
        box-shadow: 0 4px 8px rgba(255,255,255,0.3);
    }
    button.primary:hover {
        background-color: #cccccc;
        border-color: #cccccc;
        box-shadow: 0 6px 12px rgba(255,255,255,0.4);
    }
    button.secondary {
        background-color: #000000;
        color: #ffffff;
        border: 2px solid #ffffff;
        font-weight: 800;
    }
    button.secondary:hover {
        background-color: #1a1a1a;
        border-color: #ffffff;
        box-shadow: 0 4px 8px rgba(255,255,255,0.2);
    }
    
    /* Markdown Headers - Dark Theme */
    h1, h2, h3, h4 {
        color: #ffffff;
        font-weight: 800;
    }
    h3 {
        color: #ffffff;
        font-weight: 800;
    }
    
    /* Section Divider - Dark Theme */
    .section-divider {
        border-top: 2px solid #ffffff;
    }
    
    /* Card-like Containers - Dark Theme */
    .card {
        background-color: #2d3339;
        border: 1px solid #495057;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Refined Text Colors - Dark Theme */
    .text-muted {
        color: #cccccc;
        line-height: 1.6 !important;
        overflow: visible !important;
        white-space: normal !important;
        word-wrap: break-word !important;
        font-weight: 600 !important;
    }
    .text-primary {
        color: #ffffff;
        font-weight: 700;
    }
    
    /* Hexagram Container - Dark Theme */
    .hexagram-container {
        background-color: #000000 !important;
        border: 2px solid #ffffff !important;
        box-shadow: 0 4px 12px rgba(255,255,255,0.3), 0 2px 6px rgba(255,255,255,0.2) !important;
    }
    .hexagram-title {
        color: #ffffff !important;
        font-weight: 800 !important;
    }
    .hexagram-footer {
        color: #ffffff !important;
        font-weight: 700 !important;
    }
    
    /* Hexagram Line Backgrounds - Dark Theme */
    .hexagram-line {
        /* Note: Inline styles will override, but we adjust what we can */
    }
    .hexagram-line.yang {
        /* Slightly brighter red for dark theme visibility */
    }
    .hexagram-line.yin {
        /* Slightly brighter green for dark theme visibility */
    }
    /* Override hexagram line label colors in dark theme */
    .hexagram-line span {
        color: #ffffff !important;
        font-weight: 700 !important;
    }
    
    /* Gradio Component Overrides - Dark Theme */
    .gradio-container {
        background-color: #1a1d20 !important;
    }
    
    /* Textbox and Input Overrides - Dark Theme */
    .gradio-textbox, .gradio-dropdown, .gradio-checkbox {
        background-color: #2d3339 !important;
        border-color: #495057 !important;
        color: #e9ecef !important;
    }
}

/* ============================================
   Mobile Responsive Design
   ============================================ */

/* Tablet and Mobile (max-width: 768px) */
@media (max-width: 768px) {
    /* Main Container - Reduce padding */
    .main-container {
        padding: 12px;
    }
    
    /* Typography - Increase base font sizes for readability */
    body {
        font-size: 16px;
    }
    
    h1 {
        font-size: 28px;
    }
    
    h2 {
        font-size: 20px;
    }
    
    h3 {
        font-size: 17px;
    }
    
    /* Section Spacing - Reduce margins */
    .section-divider {
        margin: 24px 0;
    }
    
    /* Column Spacing - Reduce padding on mobile */
    .column-spacing {
        padding: 0 4px; /* Reduced padding for better space usage */
    }
    
    /* Hexagram Display Row - Keep horizontal layout like desktop */
    .hexagram-display-row {
        flex-direction: row !important; /* Keep same row layout as desktop */
        flex-wrap: nowrap !important; /* Prevent wrapping */
        gap: 2px !important; /* Smaller gap on mobile to fit three columns */
    }
    
    /* Ensure hexagram columns work well in horizontal layout on mobile */
    .hexagram-display-row .column-spacing {
        flex: 1 1 auto !important; /* Allow columns to flex but maintain proportions */
        min-width: 0 !important; /* Allow shrinking if needed */
    }
    
    .hexagram-display-row .column-spacing:first-child,
    .hexagram-display-row .column-spacing:last-child {
        align-items: stretch !important;
    }
    
    .hexagram-display-row .column-spacing:first-child > *,
    .hexagram-display-row .column-spacing:last-child > * {
        max-width: 100% !important;
        margin-left: 0 !important;
    }
    
    /* Yao Line Buttons - Full width on mobile, shorter height, less spacing */
    .yao-line-button {
        max-width: 100% !important;
        width: 100% !important;
        margin-left: 0 !important;
        font-size: 24px;
        padding: 10px 16px;
        min-height: 50px; /* Shorter height */
        margin: 1px 0 !important; /* Less spacing between buttons */
        position: relative;
    }
    
    /* Match hexagram-line-container margin to yao-line-button for consistent spacing */
    .hexagram-line-container {
        margin: 1px 0 !important; /* Match button margin on mobile */
    }
    
    /* Match hexagram-line padding and height to yao-line-button on mobile */
    .hexagram-line {
        padding: 10px 16px !important; /* Match button padding on mobile */
        min-height: 50px !important; /* Match button min-height on mobile */
    }
    
    /* Mobile: Show kanji instead of line symbols */
    /* For HTML elements - show/hide symbols vs kanji */
    .line-symbol-desktop {
        display: none !important; /* Hide symbols on mobile */
    }
    .line-symbol-mobile {
        display: inline !important; /* Show kanji on mobile */
    }
    
    /* For buttons - button text format: "SYMBOL line_num爻" */
    /* On mobile: Hide button text completely, show kanji via ::before, show line number via ::after */
    .yao-line-button {
        position: relative;
        /* Hide original button text completely */
        font-size: 0 !important;
        color: transparent !important;
        overflow: visible;
    }
    /* Show kanji and line number - kanji in ::before (large), line number in ::after (small) */
    /* Use CSS counters for iterative line number generation (buttons are in reverse order: 6 to 1) */
    .column-spacing { counter-reset: yao-line 7; }
    button[id^="yao-btn-"].yao-line-button {
        counter-increment: yao-line -1;
    }
    /* Kanji (陽/陰) - large font size */
    button[id^="yao-btn-"].yao-line-button::before {
        font-size: 24px !important; color: #ffffff !important;
        font-family: 'SimSun', '宋体', monospace !important;
        display: inline !important; vertical-align: middle;
        margin-right: 4px;
    }
    button[id^="yao-btn-"].yang-button::before {
        content: "陽" !important;
    }
    button[id^="yao-btn-"].yin-button::before {
        content: "陰" !important;
    }
    /* Line number (counter + 爻) - small font size */
    button[id^="yao-btn-"].yao-line-button::after {
        content: counter(yao-line) "爻" !important;
        font-size: 14px !important; color: #ffffff !important;
        font-family: 'SimSun', '宋体', monospace !important;
        display: inline !important; vertical-align: middle;
        font-weight: 600 !important;
    }
    
    /* Fallback: If button doesn't have ID yet, show kanji only (will be updated when ID is set) */
    .yao-line-button.yang-button:not([id])::before {
        content: "陽" !important;
        font-size: 18px !important;
        color: #ffffff !important;
        font-family: 'SimSun', '宋体', monospace !important;
        display: inline !important;
        vertical-align: middle;
    }
    .yao-line-button.yin-button:not([id])::before {
        content: "陰" !important;
        font-size: 18px !important;
        color: #ffffff !important;
        font-family: 'SimSun', '宋体', monospace !important;
        display: inline !important;
        vertical-align: middle;
    }
    
    /* Changing Yao Checkbox - Remove min-width constraint */
    .changing-yao-checkbox {
        min-width: 0 !important;
    }
    
    .changing-yao-checkbox > div,
    .changing-yao-checkbox > label,
    .changing-yao-checkbox label {
        font-size: 22px !important;
        min-height: 56px !important;
        padding: 12px 16px !important;
        white-space: nowrap !important;
    }
    
    /* Result Table - Better mobile handling */
    .result-table {
        font-size: 13px;
        padding: 16px;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    /* Input Styling - Full width and touch-friendly */
    input[type="text"], input[type="number"], select, textarea {
        padding: 12px 14px;
        font-size: 16px; /* Prevents zoom on iOS */
    }
    
    /* Button Styling - Touch-friendly sizing */
    button.primary,
    button.secondary {
        padding: 14px 20px;
        min-height: 44px; /* iOS minimum touch target */
    }
    
    /* Gan-Zhi Buttons - Slightly smaller but maintain touch target */
    .ganzhi-button {
        min-width: 0 !important; /* Allow shrinking below 44px if needed */
        min-height: 44px !important;
        padding: 10px 4px; /* Reduce padding for better fit */
        font-size: 15px;
        margin: 0 !important; /* Remove margins, use gap instead */
        flex: 1 1 0 !important; /* Equal growth, equal shrink, no base size */
        max-width: calc((100% - 16px) / 5) !important; /* Constrain to fit exactly 5 per row */
        box-sizing: border-box !important;
    }
    
    /* For 地支 buttons, allow 6 per row */
    .dizhi-button-row .ganzhi-button {
        max-width: calc((100% - 16px) / 6) !important; /* 6 buttons per row for 地支 */
    }
    
    /* Card padding reduction */
    .card {
        padding: 16px;
    }
}

/* Landscape orientation on mobile devices */
@media (max-width: 768px) and (orientation: landscape) {
    /* Gan-Zhi Buttons - More space in landscape, better spacing */
    .ganzhi-button {
        padding: 12px 10px !important; /* More comfortable padding in landscape */
        font-size: 16px !important; /* Slightly larger font for better readability */
        min-height: 48px !important; /* Slightly taller for better touch target */
    }
    
    /* Maintain 5 buttons per row for 天干, but with more comfortable spacing */
    .gradio-row:has(.ganzhi-button) {
        gap: 6px !important; /* Slightly larger gap in landscape */
    }
    
    .gradio-row:has(.ganzhi-button) .ganzhi-button {
        max-width: calc((100% - 24px) / 5) !important; /* Account for larger gaps */
    }
    
    /* For 地支 buttons, allow 6 per row */
    .dizhi-button-row .ganzhi-button {
        max-width: calc((100% - 24px) / 6) !important; /* 6 buttons per row for 地支 */
    }
    
    /* 地支 button rows - prevent wrapping in landscape */
    .dizhi-button-row {
        flex-wrap: nowrap !important;
        gap: 6px !important;
    }
}

/* Small Phones (max-width: 480px) - iPhone SE, iPhone 12/13 mini, etc. */
@media (max-width: 480px) {
    /* Main Container - Further reduce padding */
    .main-container {
        padding: 8px;
    }
    
    /* Typography - Further adjustments for small screens */
    h1 {
        font-size: 24px;
        margin-bottom: 6px;
    }
    
    h2 {
        font-size: 18px;
        margin-bottom: 10px;
    }
    
    h3 {
        font-size: 16px;
        margin-bottom: 8px;
    }
    
    /* Section Spacing - Tighter spacing */
    .section-divider {
        margin: 20px 0;
    }
    
    /* Column Spacing - Minimal padding on very small screens */
    .column-spacing {
        padding: 0 2px; /* Even less padding on very small screens */
    }
    
    /* Hexagram Display Row - Keep horizontal layout, minimal gap */
    .hexagram-display-row {
        flex-direction: row !important; /* Keep same row layout as desktop */
        flex-wrap: nowrap !important; /* Prevent wrapping */
        gap: 1px !important; /* Minimal gap on very small screens */
    }
    
    /* Ensure columns can shrink appropriately on very small screens */
    .hexagram-display-row .column-spacing {
        flex: 1 1 auto !important;
        min-width: 0 !important;
    }
    
    /* Yao Line Buttons - Smaller font, maintain touch target, consistent height */
    .yao-line-button {
        font-size: 22px;
        padding: 20px 12px;
        min-height: 70px; /* Match HTML min-height for alignment */
    }
    
    /* Mobile kanji for buttons on very small screens */
    .yao-line-button.yang-button::before,
    .yao-line-button.yin-button::before {
        font-size: 22px;
    }
    
    /* Changing Yao Checkbox - Smaller font */
    .changing-yao-checkbox > div,
    .changing-yao-checkbox > label,
    .changing-yao-checkbox label {
        font-size: 20px !important;
        min-height: 52px !important;
        padding: 10px 14px !important;
        white-space: nowrap !important;
    }
    
    /* Result Table - Smaller font, less padding */
    .result-table {
        font-size: 12px;
        padding: 12px;
        line-height: 1.6;
    }
    
    /* Input Styling - Ensure full width */
    input[type="text"], input[type="number"], select, textarea {
        width: 100%;
        padding: 12px;
    }
    
    /* Button Styling - Full width on very small screens */
    button.primary,
    button.secondary {
        width: 100%;
        padding: 14px 16px;
    }
    
    /* Gan-Zhi Buttons - Maintain minimum touch target */
    .ganzhi-button {
        min-width: 0 !important; /* Allow shrinking if needed */
        min-height: 44px !important;
        padding: 8px 3px; /* Reduce padding for very small screens */
        font-size: 14px;
        margin: 0 !important; /* Remove margins, use gap instead */
        flex: 1 1 0 !important; /* Equal growth, equal shrink, no base size */
        max-width: calc((100% - 16px) / 5) !important; /* Constrain to fit exactly 5 per row */
        box-sizing: border-box !important;
    }
    
    /* For 地支 buttons, allow 6 per row */
    .dizhi-button-row .ganzhi-button {
        max-width: calc((100% - 16px) / 6) !important; /* 6 buttons per row for 地支 */
    }
    
    /* Card padding - Minimal */
    .card {
        padding: 12px;
    }
    
    /* Line Preview - Smaller font */
    .line-preview {
        font-size: 20px;
        padding: 10px;
    }
    
    /* Text muted - Better line height for small screens */
    .text-muted {
        font-size: 13px !important;
        line-height: 1.5 !important;
    }
}

/* Landscape orientation on small phones */
@media (max-width: 480px) and (orientation: landscape) {
    /* Gan-Zhi Buttons - More comfortable in landscape */
    .ganzhi-button {
        padding: 10px 8px !important; /* More padding than portrait */
        font-size: 15px !important;
        min-height: 46px !important;
    }
    
    /* Maintain 5 buttons per row for 天干 in landscape with better spacing */
    .gradio-row:has(.ganzhi-button) {
        gap: 5px !important;
    }
    
    .gradio-row:has(.ganzhi-button) .ganzhi-button {
        max-width: calc((100% - 20px) / 5) !important; /* Account for gaps */
    }
    
    /* For 地支 buttons, allow 6 per row */
    .dizhi-button-row .ganzhi-button {
        max-width: calc((100% - 20px) / 6) !important; /* 6 buttons per row for 地支 */
    }
}

/* Ensure Gradio rows stack on mobile */
@media (max-width: 768px) {
    /* Target Gradio's row components to stack vertically */
    .gradio-row {
        flex-direction: column !important;
    }
    
    /* Exception: Gan-Zhi button rows should wrap horizontally, not stack */
    .gradio-row:has(.ganzhi-button) {
        flex-direction: row !important;
        flex-wrap: nowrap !important; /* Prevent wrapping within a row - each row should keep its buttons */
        gap: 4px !important;
        justify-content: flex-start !important;
        overflow: hidden !important; /* Prevent overflow */
    }
    
    /* 地支 button rows - ensure 6 buttons per row without wrapping */
    .dizhi-button-row {
        flex-direction: row !important;
        flex-wrap: nowrap !important; /* Prevent wrapping - keep 6 buttons per row */
        gap: 4px !important;
        justify-content: flex-start !important;
        overflow: hidden !important; /* Prevent overflow */
    }
    
    /* Gan-Zhi buttons should not take full width - use fixed flex basis for even distribution */
    .gradio-row:has(.ganzhi-button) > * {
        width: auto !important;
        margin-bottom: 0 !important;
    }
    
    /* Ensure ganzhi buttons in rows have proper sizing */
    .gradio-row:has(.ganzhi-button) .ganzhi-button {
        margin: 0 !important; /* Remove margins, use gap instead */
        flex: 1 1 0 !important; /* Equal growth, equal shrink, no base size */
        max-width: calc((100% - 16px) / 5) !important; /* Constrain to fit exactly 5 per row */
    }
    
    /* For 地支 buttons, allow 6 per row */
    .dizhi-button-row .ganzhi-button {
        max-width: calc((100% - 16px) / 6) !important; /* 6 buttons per row for 地支 */
    }
    
    /* Date input row - stack vertically on mobile */
    .gradio-row > * {
        width: 100% !important;
        margin-bottom: 8px;
    }
    
    /* Hide desktop number inputs on mobile, show mobile HTML5 inputs */
    .desktop-date-inputs {
        display: none !important;
    }
    
    .mobile-date-time-inputs {
        display: block !important;
    }
    
    .mobile-date-time-wrapper {
        display: block !important;
    }
}

/* Desktop: show number inputs, hide mobile HTML5 inputs */
@media (min-width: 769px) {
    .desktop-date-inputs {
        display: flex !important;
    }
    
    .mobile-date-time-inputs {
        display: none !important;
    }
    
    .mobile-date-time-wrapper {
        display: none !important;
    }
}

/* Very small screens - 2x2 grid for date inputs if needed */
@media (max-width: 480px) and (min-width: 361px) {
    /* Allow some flexibility for date inputs on very small screens */
    .gradio-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }
    
    /* Exception: Gan-Zhi button rows should use flexbox, not grid */
    .gradio-row:has(.ganzhi-button) {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: wrap !important;
        gap: 4px !important;
    }
    
    /* 地支 button rows - prevent wrapping to maintain 6 buttons per row */
    .dizhi-button-row {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 4px !important;
    }
}

/* Smallest screens - Force single column */
@media (max-width: 360px) {
    .gradio-row {
        grid-template-columns: 1fr !important;
    }
    
    /* Exception: Gan-Zhi button rows should still wrap horizontally */
    .gradio-row:has(.ganzhi-button) {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: wrap !important;
        grid-template-columns: none !important;
        gap: 3px !important;
    }
    
    /* 地支 button rows - prevent wrapping to maintain 6 buttons per row */
    .dizhi-button-row {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        grid-template-columns: none !important;
        gap: 3px !important;
    }
}

/* Coin Toss Tab Styling */
.coin-outcome-row {
    gap: 2px !important;
}

.coin-outcome-button {
    min-width: 50px;
    max-width: 70px;
    font-weight: 600;
    transition: all 0.3s ease;
    border-radius: 6px;
    padding: 10px 6px;
    font-size: 13px;
    background: #f8f9fa !important;
    color: #495057 !important;
    border: 2px solid #dee2e6 !important;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 1px;
}

.coin-outcome-button:hover {
    background: #e9ecef !important;
    border-color: #adb5bd !important;
    transform: translateY(-1px);
}

/* Yang (red) selected buttons - use multiple selectors for robustness */
button.coin-outcome-button.coin-outcome-selected.coin-yang,
.coin-outcome-button.coin-outcome-selected.coin-yang,
button.coin-yang.coin-outcome-selected {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
    color: #ffffff !important;
    border: 2px solid #b91c1c !important;
    box-shadow: 0 2px 6px rgba(239, 68, 68, 0.4) !important;
    font-weight: 700 !important;
}

button.coin-outcome-button.coin-outcome-selected.coin-yang:hover,
.coin-outcome-button.coin-outcome-selected.coin-yang:hover,
button.coin-yang.coin-outcome-selected:hover {
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
    box-shadow: 0 4px 8px rgba(239, 68, 68, 0.5) !important;
}

/* Yin (green) selected buttons - use multiple selectors for robustness */
button.coin-outcome-button.coin-outcome-selected.coin-yin,
.coin-outcome-button.coin-outcome-selected.coin-yin,
button.coin-yin.coin-outcome-selected {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%) !important;
    color: #ffffff !important;
    border: 2px solid #15803d !important;
    box-shadow: 0 2px 6px rgba(34, 197, 94, 0.4) !important;
    font-weight: 700 !important;
}

button.coin-outcome-button.coin-outcome-selected.coin-yin:hover,
.coin-outcome-button.coin-outcome-selected.coin-yin:hover,
button.coin-yin.coin-outcome-selected:hover {
    background: linear-gradient(135deg, #16a34a 0%, #15803d 100%) !important;
    box-shadow: 0 4px 8px rgba(34, 197, 94, 0.5) !important;
}

.coin-toss-line {
    margin-bottom: 10px;
    align-items: right;
    justify-content: right;
    gap: 0px !important;
}

.coin-line-label {
    display: flex;
    align-items: left;
    justify-content: left;
    text-align: center;
}

.coin-line-label *,
.coin-line-label p,
.coin-line-label markdown {
    text-align: center !important;
    margin: 0 auto !important;
    width: 100%;
    display: block;
}

.coin-outcome-row {
    display: flex;
    justify-content: center;
    align-items: center;
}

@media (max-width: 768px) {
    .coin-outcome-button {
        min-width: 45px;
        max-width: 60px;
        padding: 8px 6px;
        font-size: 11px;
        height: 36px;
        margin: 0 1px;
    }
    
    .coin-outcome-row {
        gap: 2px !important;
    }
}